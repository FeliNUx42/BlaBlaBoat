{% extends "layout/base.html" %}

{% block title %}{{ trip.title }}{% endblock %}

{% block content%}
<div class="jumbotron p-5">
  <div class="d-xl-flex justify-content-between" style="gap: 30px; justify-content: stretch;">
    <div class="flex-grow-1"  style="width:100%;">
      <h2>{{ trip.title }}</h2>
      <hr>
      <table class="table table-bordered">
        <tr>
          <th>Boat</th>
          <td>{{ trip.boat_model }}</td>
        </tr>
        <tr>
          <th>Skipper</th>
          <td>{{ trip.skipper.full_name }} &nbsp;<a href="{{ url_for('profile.user_page', uid=trip.skipper.uid) }}">(more Infos)</a></td>
        </tr>
        <tr>
          <th>Sailing Mode</th>
          <td>{{ trip.sailing_mode }}</td>
        </tr>
      </table>
      {% if trip.skipper == current_user %}
      <div class="btn-group" style="width:100%">
        <a href="{{ url_for('trips.edit', uid=trip.uid) }}" class="btn btn-primary">Edit</a>
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-{{ trip.uid }}">Delete</button>
      </div>

      <div class="modal" id="modal-{{ trip.uid }}">
        <div class="modal-dialog">
          <div class="modal-content">
          
            <div class="modal-header">
              <h5 class="modal-title">Do you really want to delete this trip?</h5>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <div class="modal-footer">
              <a href="{{ url_for('trips.delete', uid=trip.uid) }}" class="btn btn-danger">Yes</a>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
            </div>
            
          </div>
        </div>
      </div>
      
      {% endif %}
    </div>
    <div class="flex-grow-1">
      <img src="{{ url_for('static', filename='pictures/'+trip.banner) }}" style="width: 100%; height: 100%; object-fit: contain; object-position: center;">
  </div>
  </div>
</div>

<div>
  <h3 data-toggle="collapse" data-target="#desc" class="mb-4">
    <i class="lni lni-circle-plus" style="display:none"></i>
    <i class="lni lni-circle-minus"></i>
    Description
  </h3>
  <div class="collapse mb-4 show" id="desc">{{ trip.description }}</div>
</div>
<hr>
<div>
  <h3 data-toggle="collapse" data-target="#dest" class="mb-4">
    <i class="lni lni-circle-plus"></i>
    <i class="lni lni-circle-minus"  style="display:none"></i>
    Destinations
  </h3>
  <div class="collapse mb-4" id="dest">
    <table class="table">
      <thead>
        <tr>
          <th>Destination</th>
          <th>Time of Arrival</th>
          <th>Time of Departure</th>
          <th>View on Map</th>
        </tr>
      </thead>
      <tbody>
        {% if destinations %}
        {% for destination in destinations %}
        <tr>
          <td>{{ destination.name }}</td>
          <td>{{ moment(destination.arrival).format("DD MMM, YYYY") if destination.arrival else "<i>Not set</i>" | safe }}</td>
          <td>{{ moment(destination.departure).format("DD MMM, YYYY") if destination.departure else "<i>Not set</i>" | safe }}</td>
          <td><button class="btn btn-primary btn-sm">Show on map</button></td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="4" class="text-center"><b>No destinations yet.</b></td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
<hr>
<div>
  <h3 data-toggle="collapse" data-target="#info" class="mb-4">
    <i class="lni lni-circle-plus"></i>
    <i class="lni lni-circle-minus" style="display:none"></i>
    More Information
  </h3>
  <div class="collapse mb-4" id="info">
    <div class="row mb-4">
      <div class="col">
        <h5 style="font-size:16px">Boat type</h5>
        <p style="font-size:18px; font-weight:bold">{{ trip.boat_type }}</p>
      </div>
      <div class="col">
        <h5 style="font-size:16px">Travel expenses</h5>
        <p style="font-size:18px; font-weight:bold">{{ trip.travel_expenses }}</p>
      </div>
    </div>
    <div class="row mb-4">
      <div class="col">
        <h5 style="font-size:16px">Boat model</h5>
        <p style="font-size:18px; font-weight:bold">{{ trip.boat_model }}</p>
      </div>
      <div class="col">
        <h5 style="font-size:16px">Qualification level required</h5>
        <p style="font-size:18px; font-weight:bold">{{ trip.qualif_level }}</p>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <h5 style="font-size:16px">Sailing mode</h5>
        <p style="font-size:18px; font-weight:bold">{{ trip.sailing_mode }}</p>
      </div>
      <div class="col">
        <h5 style="font-size:16px">Date posted</h5>
        <p style="font-size:18px; font-weight:bold">{{ moment(trip.created).format("DD MMMM, YYYY") }}</p>
      </div>
    </div>
  </div>
</div>
<hr>
<div>
  <h3 data-toggle="collapse" data-target="#imgs" class="mb-4">
    <i class="lni lni-circle-plus"></i>
    <i class="lni lni-circle-minus" style="display:none"></i>
    Images
  </h3>
  <div class="collapse mb-4 carousel slide" data-ride="carousel" id="imgs">
    <!-- Indicators -->
    <ul class="carousel-indicators">
      <li data-target="#imgs" data-slide-to="0" class="active"></li>
      <li data-target="#imgs" data-slide-to="1"></li>
      <li data-target="#imgs" data-slide-to="2"></li>
    </ul>
  
    <!-- The slideshow -->
    <div class="carousel-inner bg-dark">
      <div class="carousel-item active">
        <img src="https://news-palstek.de/wp-content/uploads/2021/06/SVB_Team_Lorient5-1030x686.jpg" style="height: 500px; width: 100%; object-fit: contain; object-position: center;">
      </div>
      <div class="carousel-item">
        <img src="https://news-palstek.de/wp-content/uploads/2021/06/SVB_Team_Lorient5-1030x686.jpg" style="height: 500px; width: 100%; object-fit: contain; object-position: center;">
      </div>
      <div class="carousel-item">
        <img src="https://news-palstek.de/wp-content/uploads/2021/06/SVB_Team_Lorient5-1030x686.jpg" style="height: 500px; width: 100%; object-fit: contain; object-position: center;">
      </div>
    </div>
  
    <!-- Left and right controls -->
    <a class="carousel-control-prev" href="#imgs" data-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </a>
    <a class="carousel-control-next" href="#imgs" data-slide="next">
      <span class="carousel-control-next-icon"></span>
    </a>
  
  </div>
</div>
{% if current_user != trip.skipper %}
<hr>
<div>
  <h3 data-toggle="collapse" data-target="#contact" class="mb-4">
    <i class="lni lni-circle-plus"></i>
    <i class="lni lni-circle-minus" style="display:none"></i>
    Contact Skipper
  </h3>
  <div class="collapse" id="contact">
    {% if current_user.is_authenticated %}
    <form action="" method="post">
      {{ form.csrf_token() }}

      <div class="form-group">
        <div>{{ form.subject(class="form-control", placeholder="Subject...") }}</div>
      </div>

      <div class="form-group">
        <div>{{ form.content(class="form-control", placeholder="Content...", rows="7") }}</div>
      </div>

      <div class="form-group">
        <div>{{ form.submit(class="btn btn-primary")}}</div>
      </div>
    </form>
    {% else %}
    <p>You need to be logged in in order to contact the skipper. <a href="{{ url_for('auth.login') }}">Log In</a></p>
    {% endif %}
  </div>
</div>
{% endif %}

<script>
  $(document).ready(function(){
    $(".collapse").on("show.bs.collapse", function () {
      $(`h3[data-target='#${this.id}'] .lni-circle-plus`).hide();
      $(`h3[data-target='#${this.id}'] .lni-circle-minus`).show();
    });

    $(".collapse").on("hide.bs.collapse", function () {
      $(`h3[data-target='#${this.id}'] .lni-circle-plus`).show();
      $(`h3[data-target='#${this.id}'] .lni-circle-minus`).hide();
    });
  });
</script>
{% endblock %}

